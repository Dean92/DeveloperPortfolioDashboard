@page "/"
@using PortfolioClient.Wasm.Services
@inject IJSRuntime JSRuntime
@inject IAnalyticsService AnalyticsService
@inject NavigationManager NavigationManager

<PageTitle>Dean McCoy - Portfolio</PageTitle>

<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>

<div class="container">
    <nav role="navigation" aria-label="Main navigation">
        <a class="logo" @onclick="GoHome" @onkeydown="@((e) => HandleKeyPress(e, GoHome))" tabindex="0" role="button" aria-label="Go to home page">DM</a>
        <ul class="nav-links">
            <li><a class="nav-link @(currentSection == "home" ? "active" : "")" @onclick="GoHome" @onkeydown="@((e) => HandleKeyPress(e, GoHome))" tabindex="0" role="button" aria-label="Navigate to home section" aria-current="@(currentSection == "home" ? "page" : null)">Home</a></li>
            <li><a class="nav-link @(currentSection == "experience" ? "active" : "")" @onclick="GoExperience" @onkeydown="@((e) => HandleKeyPress(e, GoExperience))" tabindex="0" role="button" aria-label="Navigate to experience section" aria-current="@(currentSection == "experience" ? "page" : null)">Experience</a></li>
            <li><a class="nav-link @(currentSection == "skills" ? "active" : "")" @onclick="GoSkills" @onkeydown="@((e) => HandleKeyPress(e, GoSkills))" tabindex="0" role="button" aria-label="Navigate to skills section" aria-current="@(currentSection == "skills" ? "page" : null)">Skills</a></li>
            <li><a class="nav-link @(currentSection == "projects" ? "active" : "")" @onclick="GoProjects" @onkeydown="@((e) => HandleKeyPress(e, GoProjects))" tabindex="0" role="button" aria-label="Navigate to projects section" aria-current="@(currentSection == "projects" ? "page" : null)">Projects</a></li>
            <li><a class="nav-link @(currentSection == "contact" ? "active" : "")" @onclick="GoContact" @onkeydown="@((e) => HandleKeyPress(e, GoContact))" tabindex="0" role="button" aria-label="Navigate to contact section" aria-current="@(currentSection == "contact" ? "page" : null)">Contact</a></li>
        </ul>
    </nav>

    <!-- Home Section -->
    <section class="hero @(currentSection != "home" ? "hidden" : "")" id="home-section" role="main" aria-label="Home section">
        <div class="hero-content">
            <p class="greeting">Welcome, my name is</p>
            <h1 class="name">Dean McCoy</h1>
            <div class="tagline-container">
                <span class="tagline-prefix">I build compelling </span>
                <span class="tagline-animated" id="animatedText" aria-live="polite">digital experiences</span>
            </div>
            <p class="description">
                Software engineer with over 18 years of experience, passionate about solving problems with code.
                Specializing in C#, ASP.NET Core, Angular, Blazor, and Microsoft SQL Server.
            </p>
            <button type="button" class="cta-button" @onclick="GoProjects" @onkeydown="@((e) => HandleKeyPress(e, GoProjects))" aria-label="View my projects portfolio">
                View my projects
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
            </button>
        </div>
    </section>

    <!-- Experience Section -->
    <div class="@(currentSection != "experience" ? "hidden" : "")" role="region" aria-label="Work experience section">
        <ExperienceSection />
    </div>

    <!-- Skills Section -->
    <div class="@(currentSection != "skills" ? "hidden" : "")" role="region" aria-label="Skills and technologies section">
        <SkillsSection />
    </div>

    <!-- Projects Section -->
    <div class="@(currentSection != "projects" ? "hidden" : "")" role="region" aria-label="Portfolio projects section">
        <ProjectsSection />
    </div>

    <!-- Contact Section -->
    <div class="@(currentSection != "contact" ? "hidden" : "")" role="region" aria-label="Contact information section">
        <ContactSection />
    </div>
</div>

<!-- Footer Component -->
<Footer />

<script suppress-error="BL9992">
    // Inline backup animation script
    (function ()
    {
        if (typeof window.initPortfolio === 'undefined')
        {
            console.log('Creating inline initPortfolio function');
            window.initPortfolio = function ()
            {
                console.log('Inline initPortfolio called');
                setTimeout(function ()
                {
                    var elem = document.getElementById('animatedText');
                    if (elem)
                    {
                        console.log('Element found by inline script');
                        var texts = [ 'digital experiences', 'web applications', 'user interfaces', 'scalable solutions' ];
                        var idx = 0;
                        elem.style.transition = 'opacity 0.3s ease';
                        setInterval(function ()
                        {
                            idx = (idx + 1) % texts.length;
                            elem.style.opacity = '0';
                            setTimeout(function ()
                            {
                                elem.textContent = texts[ idx ];
                                elem.style.opacity = '1';
                            }, 300);
                        }, 3000);
                    } else
                    {
                        console.log('Element not found by inline script');
                    }
                }, 500);
            };
        }
    })();
</script>

@code {
    private string currentSection = "home";
    private bool hasInitialized = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            hasInitialized = true;
            await Task.Delay(300);
            await JSRuntime.InvokeVoidAsync("initPortfolio");
            await JSRuntime.InvokeVoidAsync("eval", "console.log('Home.razor: Component initialized')");

            // Track initial page view
            await AnalyticsService.TrackPageView("Home", NavigationManager.Uri);
        }
    }

    private void HandleKeyPress(KeyboardEventArgs e, Action action)
    {
        if (e.Key == "Enter" || e.Key == " ")
        {
            action();
        }
    }

    private void GoHome() => _ = ShowSection("home");
    private void GoExperience() => _ = ShowSection("experience");
    private void GoSkills() => _ = ShowSection("skills");
    private void GoProjects() => _ = ShowSection("projects");
    private void GoContact() => _ = ShowSection("contact");

    private async Task ShowSection(string section)
    {
        await JSRuntime.InvokeVoidAsync("eval", $"console.log('ShowSection called with: {section}')");
        currentSection = section;
        StateHasChanged();

        // Track section navigation
        await AnalyticsService.TrackSectionNavigation(section);

        if (section != "home")
        {
            try
            {
                await JSRuntime.InvokeVoidAsync("scrollToTop");
            }
            catch (Exception ex)
            {
                await JSRuntime.InvokeVoidAsync("eval", $"console.error('Error scrolling: {ex.Message}')");
            }
        }
        else if (section == "home" && hasInitialized)
        {
            await Task.Delay(300);
            await JSRuntime.InvokeVoidAsync("initPortfolio");
        }
    }
}