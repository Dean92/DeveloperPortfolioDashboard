@using PortfolioShared.Models
@using PortfolioClient.Wasm.Services
@inject IProjectService ProjectService

<section class="projects-section" id="projects-section" role="region" aria-label="Portfolio projects">
    <div class="section-header">
        <h2 class="section-title">Projects</h2>
        <p class="section-subtitle">
            Welcome to my portfolio, featuring a selection of personal projects I've developed alongside my professional experience.
            Be sure to check out my professional work experience for more examples of what I do.
        </p>
        <p class="section-subtitle" style="margin-top: 1rem;">
            Additional projects not listed here, such as client work, can be shared upon request.
        </p>
    </div>

    @if (isLoading)
    {
        <div class="loading-message" role="status" aria-live="polite">
            <p>Loading projects...</p>
        </div>
    }
    else if (projects == null || !projects.Any())
    {
        <div class="no-projects-message" role="status">
            <p>No projects available at this time.</p>
        </div>
    }
    else
    {
        <div class="projects-list" role="list" aria-label="Project items">
            @foreach (var project in projects)
            {
                <article class="project-item" role="listitem">
                    <div class="project-content">
                        <h3 class="project-item-title">@project.Title</h3>

                        @if (!string.IsNullOrEmpty(project.IntroDescription))
                        {
                            <p class="project-intro">@project.IntroDescription</p>
                        }

                        @if (!string.IsNullOrEmpty(project.Description))
                        {
                            <p class="project-details">@project.Description</p>
                        }

                        @if (!string.IsNullOrEmpty(project.DetailedDescription))
                        {
                            <p class="project-details">@project.DetailedDescription</p>
                        }

                        @if (project.KeyFeatures != null && project.KeyFeatures.Any())
                        {
                            <h4 class="project-features-title">Key Features and Achievements</h4>
                            <ul class="project-features" aria-label="Project features">
                                @foreach (var feature in project.KeyFeatures)
                                {
                                    <li>► @((MarkupString)feature)</li>
                                }
                            </ul>
                        }

                        @if (project.Technologies != null && project.Technologies.Any())
                        {
                            <div class="project-tech-stack" role="list" aria-label="Technologies used">
                                @foreach (var tech in project.Technologies)
                                {
                                    <span class="tech-badge" role="listitem">@tech</span>
                                }
                            </div>
                        }

                        <div class="project-actions">
                            @if (!string.IsNullOrEmpty(project.ProjectUrl))
                            {
                                <a href="@project.ProjectUrl" target="_blank" rel="noopener noreferrer" class="project-action-link" aria-label="View @project.Title project (opens in new window)">View Project</a>
                            }
                            @if (!string.IsNullOrEmpty(project.GitHubUrl))
                            {
                                <a href="@project.GitHubUrl" target="_blank" rel="noopener noreferrer" class="project-action-link" aria-label="View @project.Title source code on GitHub (opens in new window)">View Source Code</a>
                            }
                        </div>
                    </div>
                </article>
            }
        </div>
    }
</section>

@code {
    private List<Project>? projects;
    private bool isLoading = true;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await LoadProjects();
    }

    private async Task LoadProjects()
    {
        try
        {
            isLoading = true;
            projects = await ProjectService.GetProjectsAsync();
        }
        catch (Exception ex)
        {
            errorMessage = $"Error loading projects: {ex.Message}";
            Console.WriteLine(errorMessage);

            // Service already handles fallback, but just in case
            projects = new List<Project>();
        }
        finally
        {
            isLoading = false;
        }
    }
}